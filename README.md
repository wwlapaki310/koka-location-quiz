# 校歌場所当てゲーム (Koka Location Quiz)

## 📝 プロジェクト概要

テレビ番組で見かけた「校歌の歌詞から学校の場所を推測する」ゲームをWebアプリ・スマホアプリ化するプロジェクトです。

### ゲームの仕組み
- 中学校の校歌から学校名を伏せた歌詞を表示
- 地図を見ながら（検索機能は使わず）どの学校かを予想
- 3回勝負でスコアを競う

## 🚀 **現在の状況（2025年8月更新）**

### ✅ **MVP完成済み + データ収集基盤構築完了**

#### **実装済み機能（MVP）:**
- ✅ React + Vite + TypeScript + Tailwind CSS
- ✅ 地図中心のゲームUI（地図回答機能）
- ✅ 校歌全文表示機能
- ✅ 段階的ヒント機能（都道府県→地域→4択）
- ✅ スコア調整システム（地図回答ボーナス・ヒント減点）
- ✅ 5校分の高品質サンプルデータ
- ✅ レスポンシブデザイン対応

#### **データ収集システム（新規完成）:**
- ✅ **自動データ収集ツール**: `tools/data_collector.py`
  - Google Custom Search API による学校サイト発見
  - BeautifulSoup による校歌情報自動抽出
  - Google Geocoding API による座標取得
  - マスク済み歌詞・ヒント情報の自動生成
- ✅ **品質管理システム**: `tools/quality_manager.py`
  - A/B/C/D級品質自動判定
  - 重複検出・データ妥当性チェック
  - 品質レポート自動生成
- ✅ **Googleスプレッドシート連携**: `tools/sheets_manager.py`
  - 自動データ登録・進捗管理
  - 都道府県別進捗可視化
  - MVP用データエクスポート

**技術スタック（確定）：**
```javascript
{
  "frontend": "React + Vite + TypeScript",
  "styling": "Tailwind CSS",
  "icons": "Lucide React",
  "map": "React Leaflet + OpenStreetMap",
  "data_collection": "Python + BeautifulSoup + Google APIs",
  "deployment": "Vercel Ready"
}
```

### 🎯 **現在進行中 - 大量データ収集プロジェクト**

#### **Issue #8: 全国1000件の校歌データベース構築**

**📊 目標と戦略:**
- **目標件数**: 1,000件（8週間以内）
- **地域別目標配分**:
  - 関東: 250件 🎯
  - 関西: 200件
  - 九州・沖縄: 200件
  - 中部: 150件
  - 北海道・東北: 100件
  - 中国・四国: 100件

**🔧 実行準備完了:**
```bash
# セットアップ（1回のみ）
cd tools
./setup.sh

# API設定後、パイロット実行
./main.py --prefecture 東京都 --max-schools 5 --dry-run

# 本格実行例
./main.py --all-kanto --max-schools 20 --upload-sheets
```

**📈 推定性能:**
- 処理速度: 1校あたり2-3秒
- 成功率: 60-80%
- 1日処理能力: 500-800校（8時間稼働）

### 🎮 ゲーム体験の進化

**現在のMVP:**
```
校歌全文表示 → 地図で推測（メイン） → 困ったらヒント → 4択（最終手段） → 結果表示
```

**特徴:**
- 🗺️ **地図機能がメイン**: クリックして回答、50km以内で正解
- 📖 **校歌全文表示**: 学校名も含む完全版が読める
- 💡 **段階的ヒント機能**: 都道府県→地域→4択（使用で減点）
- 📊 **スコア調整**: 地図回答ボーナス+20点、ヒント使用で-20点/個

## 🎯 プロジェクト目標

1. **教育的価値**: 日本の地理・文化への理解促進
2. **エンターテイメント性**: 楽しく学べるクイズゲーム
3. **技術的挑戦**: モダンなWeb/モバイルアプリ開発
4. **データ活用**: 校歌という文化資産のデジタル化

## 📊 校歌に関する調査結果

### 校歌の歴史と意義

#### 歴史的背景
- **起源**: 明治30年代（1897年頃）から制定開始
- **最古の校歌**: 東京女子師範学校（現お茶の水女子大学）1878年
- **法的位置づけ**: 法令による制定義務はないが、慣習的に存在
- **文化的特徴**: 日本・中国・韓国など東アジア特有の文化（欧米にはほぼ存在しない）

#### 制作過程の変遷
- **明治期**: 文部省による認可制度（1894年～）
- **初期**: 同一歌詞の校歌が複数校で使用される例が多数
- **大正期以降**: 各校独自性を重視、地域環境を歌詞に反映
- **1930年頃**: 全国的に校歌が普及
- **戦後**: 軍国調の校歌から新時代に適した校歌への改変

#### 歌詞の特徴
校歌の歌詞によく歌われる内容：
- 学校所在地周辺の自然・地理・風土・具体的地名
- 学校の標語・校訓・教育理念・校風
- 建学の精神・歴史的背景

## 📈 市場データ

### 中学校数（2024年現在）
- **全国総数**: 9,882校
- **公立**: 約91%（減少傾向）
- **私立**: 約7.9%（増加傾向、1990年比約1.3倍）
- **国立**: 68校（全体の1%未満）

### データの利用可能性
- **信時潔データベース**: 893校の校歌データ（作詞者、歌い出し、日付等）
- **国立国会図書館**: 校歌関連資料多数
- **地方自治体**: 各地域の校歌集が存在

## 🏗️ システムアーキテクチャ

### 確定済み技術スタック

#### フロントエンド（実装済み）
- **Web**: React + Vite + TypeScript
- **UI/UX**: Tailwind CSS
- **アイコン**: Lucide React
- **地図**: React Leaflet + OpenStreetMap

#### データ収集・管理（実装済み）
- **収集エンジン**: Python + BeautifulSoup + Requests
- **API連携**: Google Custom Search API + Geocoding API
- **品質管理**: 自動品質判定・重複検出
- **データ管理**: Googleスプレッドシート + CSV

#### 将来検討
- **バックエンド**: Node.js + Express または Python + FastAPI
- **データベース**: PostgreSQL + Redis（キャッシュ）
- **認証**: Firebase Auth または Auth0

### データ構造設計（実装済み）

```typescript
interface SchoolData {
  id: number;
  schoolName: string;
  prefecture: string;
  city: string;
  address: string;
  coordinates: {
    lat: number;
    lng: number;
  };
  songTitle: string;
  lyrics: string;           // 全文歌詞
  maskedLyrics: string;     // マスク済み
  difficulty: 'easy' | 'medium' | 'hard';
  notes: string;
  hints: {
    prefecture: string;     // 都道府県ヒント
    region: string;         // 地域ヒント  
    landmark: string;       // 地理的特徴ヒント
  };
}
```

## 🎮 ゲーム仕様

### 現在のMVP仕様（実装済み）
1. **ゲーム開始画面**: ルール説明とスタートボタン
2. **クイズ画面**: 
   - 校歌全文表示（学校名含む）
   - 地図メインUI（左：歌詞、右：地図）
   - 段階的ヒント機能（3段階）
   - 地図回答 + 4択選択肢
3. **結果画面**: 正解・不正解、学校情報、スコア
4. **最終結果**: 5問完了後の総合スコア

### 難易度設定
- **Easy**: 有名な地名・特徴的な自然環境が歌詞に含まれる
- **Medium**: 一般的な地理的特徴
- **Hard**: 抽象的表現や歴史的背景が中心

## 🚀 開発フェーズ（更新版）

### ~~Phase 1: MVP構築~~ ✅ **完了**
- [x] React + Vite + TypeScript基盤
- [x] 地図中心のゲームUI
- [x] 校歌全文表示・ヒント機能
- [x] 高品質サンプルデータ5校

### ~~Phase 2: データ収集基盤~~ ✅ **完了**
- [x] 自動データ収集ツール開発
- [x] 品質管理システム構築
- [x] Googleスプレッドシート連携
- [x] セットアップ・運用ツール整備

### Phase 3: 大量データ収集（進行中）
**Issue #8で管理中**
- [ ] パイロット実行（関東100校）
- [ ] 自動収集本格稼働（600-700校）
- [ ] 手動収集体制構築（300-400校）
- [ ] 品質向上（A+B級データ80%以上）

### Phase 4: 機能拡張（6週間）
- [ ] ユーザー認証
- [ ] ランキング機能
- [ ] 実績システム
- [ ] SNS連携

### Phase 5: テスト・リリース（4週間）
- [ ] 総合テスト
- [ ] パフォーマンス最適化
- [ ] 本格リリース
- [ ] 運用保守体制構築

## ⚖️ 課題・リスク

### 著作権・法的課題
- **校歌の著作権**: 作詞者・作曲者の権利確認が必要
- **パブリックドメイン**: 古い校歌（1953年以前の没作者）の活用
- **使用許可**: 現代の校歌使用には権利者許可が必要

### データ収集の課題
- **データ入手困難**: 統一されたデータベースが存在しない
- **品質確保**: 歌詞の正確性確保
- **網羅性**: 全国9,882校の完全カバーは困難

### 技術的課題
- **API制限**: Google APIクォータ管理
- **サイト構造変化**: 抽出ルールの継続改善
- **スケーラビリティ**: ユーザー増加への対応

## 💡 差別化ポイント

1. **教育的価値**: 単なるクイズではなく文化学習ツール
2. **地域密着**: 各地方の特色を活かしたコンテンツ
3. **データの質**: 学術的価値のある校歌データベース構築
4. **ユーザー体験**: 直感的で楽しいUI/UX

## 🎨 UI/UXコンセプト

### デザイン方針
- **親しみやすさ**: 老若男女が楽しめるインターフェース
- **視認性**: 地図と歌詞の同時表示での見やすさ
- **応答性**: 快適な操作感
- **学習促進**: 正解後の詳細情報表示

### ターゲットユーザー
- **主要**: 20-50代の日本在住者
- **副次**: 日本文化に興味のある海外ユーザー
- **教育**: 学校での地理・社会科教材として

## 📚 参考資料

- 渡辺裕『校歌斉唱！―日本人が育んだ学校文化の謎―』新潮社
- 須田珠生『校歌の誕生』人文書院
- [信時潔研究ガイド - 校歌データベース](https://nobutoki.com/koka_db)
- [文部科学省 学校基本調査](https://www.mext.go.jp/b_menu/toukei/chousa01/kihon/1267995.htm)

## 🔄 プロジェクト管理

### Issue管理
- **#8**: 大量データ収集プロジェクト（P0・進行中）
- **#9**: データ収集基盤構築（P0・完了）
- **#7**: 地図中心UI改善（P0・完了）
- **#1-5**: 基礎調査・技術選定（完了）

### 進捗管理
- GitHub Projects使用
- 週次レビュー実施
- マイルストーン設定

## 📱 アプリケーション実行方法

### MVPゲームの起動
```bash
# MVPアプリの起動
cd mvp
npm install
npm run dev
```

ブラウザで `http://localhost:5173` にアクセス

### データ収集ツールの使用
```bash
# セットアップ（初回のみ）
cd tools
./setup.sh

# API設定ファイル編集
cp config.json.sample config.json
# config.json を編集してGoogle APIキー等を設定

# パイロット実行
./main.py --prefecture 東京都 --max-schools 3 --dry-run

# 実際の収集実行
./main.py --all-kanto --max-schools 10 --output-csv kanto_schools.csv
```

---

**最終更新**: 2025年8月1日  
**ステータス**: データ収集基盤完成、大量データ収集準備完了  
**次のアクション**: パイロット実行（関東100校収集テスト）  
**現在のマイルストーン**: Phase 3 大量データ収集開始
