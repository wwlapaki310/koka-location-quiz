# 校歌場所当てゲーム (Koka Location Quiz)

## 📝 プロジェクト概要

テレビ番組で見かけた「校歌の歌詞から学校の場所を推測する」ゲームをWebアプリ・スマホアプリ化するプロジェクトです。

### ゲームの仕組み
- 中学校の校歌から学校名を伏せた歌詞を表示
- 地図を見ながら（検索機能は使わず）どの学校かを予想
- 5回勝負でスコアを競う

## 🚀 **現在の状況（2025年8月2日更新）**

### 🎯 **Phase 3開始: パイロット実行準備完了**

#### **2025年8月2日の進捗:**
- ✅ **プロジェクト現状確認**: Phase 2B完了、Phase 3準備完了を確認
- ✅ **Issue #10作成**: パイロット実行開始の詳細計画策定
- ✅ **Google API設定ガイド**: `docs/google-api-setup.md` 作成
- ✅ **DRY RUNテストスクリプト**: `pilot_execution_test.py` 作成
- 🔄 **パイロット実行開始準備**: API設定→実行準備中

#### **次のアクション（immediate）:**
```bash
# 1. Google API設定
# docs/google-api-setup.md の手順に従ってAPI設定

# 2. DRY RUN実行
python3 pilot_execution_test.py

# 3. パイロット実行開始
cd tools
python3 pilot_execution.py --dry-run   # 計画確認
python3 pilot_execution.py            # 本格実行
```

---

### ✅ **Phase 2B完了: MVPデータ拡張・パイロット実行準備完了**

#### **MVP大幅強化（完成済み）:**
- ✅ **データ量4倍増**: 5校 → **20校**（全国各地から厳選）
- ✅ **地域バランス**: 北海道から沖縄まで全地方カバー
- ✅ **難易度分散**: Easy 10校・Medium 9校・Hard 1校
- ✅ **ゲーム体験向上**: リプレイ性・満足度大幅向上
- ✅ **評価システム強化**: 校歌マスター等のレベル判定

#### **データ収集システム（実用化完了）:**
- ✅ **自動データ収集ツール**: `tools/data_collector.py`
- ✅ **品質管理システム**: `tools/quality_manager.py`（A/B/C/D級評価）
- ✅ **進捗監視ダッシュボード**: `tools/progress_dashboard.py`（リアルタイム可視化）
- ✅ **パイロット実行システム**: `tools/pilot_execution.py`（関東100校テスト）
- ✅ **Googleスプレッドシート連携**: `tools/sheets_manager.py`

**技術スタック（最終版）：**
```javascript
{
  "frontend": "React + Vite + TypeScript",
  "styling": "Tailwind CSS",
  "icons": "Lucide React", 
  "map": "React Leaflet + OpenStreetMap",
  "data_collection": "Python + BeautifulSoup + Google APIs",
  "visualization": "matplotlib + seaborn + plotly",
  "deployment": "Vercel Ready"
}
```

---

### 🎯 **Phase 3実行中: 全国1000件データベース構築**

#### **Issue #10: パイロット実行開始**

**📊 パイロット実行計画:**
- **対象地域**: 関東1都6県（東京、神奈川、埼玉、千葉、茨城、栃木、群馬）
- **目標件数**: 100校（東京20校、神奈川18校、その他合計62校）
- **品質目標**: A+B級80%以上
- **成功率目標**: 70%以上
- **実行時間目標**: 2時間以内

**🔧 実行手順（準備完了）:**
```bash
# Phase 3環境構築
cd tools
./setup.sh

# API設定（Google Custom Search + Geocoding）
# docs/google-api-setup.md の手順に従って設定

# 🧪 パイロット実行テスト（DRY RUN）
python3 pilot_execution.py --dry-run

# 📊 進捗監視ダッシュボード確認
python3 progress_dashboard.py

# 🚀 パイロット実行（関東100校収集）
python3 pilot_execution.py

# 本格実行移行（パイロット成功後）
python3 data_collector.py --all-regions --max-schools 1000
```

**📈 期待される成果（パイロット実行）:**
- 処理速度: 1校あたり2-3秒
- 成功率: 70%以上
- 品質A+B級: 80%以上
- 収集データ: 関東地方100校（MVPデータを5倍増強）

**📅 Phase 3スケジュール:**
- **Week 1**: パイロット実行（関東100校）🔄実行準備完了
- **Week 2-3**: 自動収集本格稼働（関東・関西 400校）
- **Week 4-5**: 九州・中部展開（350校）
- **Week 6-7**: 北海道・東北・中国四国（250校）
- **Week 8**: 品質向上・データ統合・最終調整

---

### 🎮 **現在のゲーム体験（20校対応）**

**ゲームフロー:**
```
校歌全文表示 → 地図で推測（メイン） → 困ったらヒント → 4択（最終手段） → 結果表示
```

**特徴:**
- 🗺️ **地図機能がメイン**: クリックして回答、50km以内で正解
- 📖 **校歌全文表示**: 学校名も含む完全版が読める
- 💡 **段階的ヒント機能**: 都道府県→地域→4択（使用で減点）
- 📊 **スコア調整**: 地図回答ボーナス+20点、ヒント使用で-20点/個
- 🎯 **20校データ**: 全国各地の多様な学校で充実したゲーム体験

**収録学校（20校）:**
- **北海道・東北**: 札幌雪原・仙台杜・津軽 (3校)
- **関東**: 戸山・横浜港・筑波研究 (4校)  
- **中部**: 千曲川・富士山・加賀温泉 (3校)
- **関西**: 京都古都・大阪商人・奈良古寺 (3校)
- **中国・四国**: 瀬戸内・広島平和・高知土佐 (3校)
- **九州・沖縄**: 博多祭・熊本城・桜島・首里城 (4校)

---

## 🎯 プロジェクト目標

1. **教育的価値**: 日本の地理・文化への理解促進
2. **エンターテイメント性**: 楽しく学べるクイズゲーム
3. **技術的挑戦**: モダンなWeb/モバイルアプリ開発
4. **データ活用**: 校歌という文化資産のデジタル化
5. **スケーラビリティ**: 1000件データベースの構築・運用

## 🚀 開発フェーズ（最新版）

### ~~Phase 1: MVP構築~~ ✅ **完了**
- [x] React + Vite + TypeScript基盤
- [x] 地図中心のゲームUI
- [x] 校歌全文表示・ヒント機能
- [x] 5校サンプルデータ

### ~~Phase 2A: データ収集基盤~~ ✅ **完了**
- [x] 自動データ収集ツール開発
- [x] 品質管理システム構築
- [x] Googleスプレッドシート連携

### ~~Phase 2B: 実用化・データ拡張~~ ✅ **完了**
- [x] MVPデータ5校→20校拡張
- [x] 進捗監視ダッシュボード構築
- [x] パイロット実行システム完成
- [x] 環境整備・requirements更新

### Phase 3: 大量データ収集 🔄 **実行中**
**Issue #10で管理中**
- [x] **準備完了**: パイロット実行システム、API設定ガイド作成
- [ ] **Week 1**: パイロット実行（関東100校）🔄準備完了
- [ ] **Week 2-3**: 自動収集本格稼働（関東・関西 400校）
- [ ] **Week 4-5**: 九州・中部展開（350校）
- [ ] **Week 6-7**: 北海道・東北・中国四国（250校）
- [ ] **Week 8**: 品質向上・データ統合・最終調整

### Phase 4: 機能拡張（8週間）
- [ ] ユーザー認証・アカウント機能
- [ ] ランキング・ソーシャル機能
- [ ] 実績システム・バッジ機能
- [ ] SNS連携・シェア機能

### Phase 5: テスト・リリース（4週間）
- [ ] 総合テスト・品質保証
- [ ] パフォーマンス最適化
- [ ] 本格リリース・マーケティング
- [ ] 運用保守体制構築

---

## 🏗️ システムアーキテクチャ

### 確定済み技術スタック

#### フロントエンド（実装済み）
- **Web**: React + Vite + TypeScript
- **UI/UX**: Tailwind CSS
- **アイコン**: Lucide React
- **地図**: React Leaflet + OpenStreetMap

#### データ収集・管理（実装済み）
- **収集エンジン**: Python + BeautifulSoup + Requests
- **API連携**: Google Custom Search API + Geocoding API
- **品質管理**: 自動品質判定・重複検出
- **データ管理**: Googleスプレッドシート + CSV/JSON
- **可視化**: matplotlib + seaborn + plotly

#### 将来検討
- **バックエンド**: Node.js + Express または Python + FastAPI
- **データベース**: PostgreSQL + Redis（キャッシュ）
- **認証**: Firebase Auth または Auth0

### データ構造設計（実装済み）

```typescript
interface SchoolData {
  id: number;
  schoolName: string;
  prefecture: string;
  city: string;
  address: string;
  coordinates: {
    lat: number;
    lng: number;
  };
  songTitle: string;
  lyrics: string;           // 全文歌詞
  maskedLyrics: string;     // マスク済み
  difficulty: 'easy' | 'medium' | 'hard';
  notes: string;
  hints: {
    prefecture: string;     // 都道府県ヒント
    region: string;         // 地域ヒント  
    landmark: string;       // 地理的特徴ヒント
  };
  composer?: string;
  lyricist?: string;
  establishedYear?: number;
  dataSource: string;
}
```

---

## 🎮 ゲーム仕様

### 現在のMVP仕様（20校対応・実装済み）
1. **ゲーム開始画面**: ルール説明、データ統計表示、スタートボタン
2. **クイズ画面**: 
   - 校歌全文表示（学校名含む）
   - 地図メインUI（左：歌詞、右：地図）
   - 段階的ヒント機能（3段階）
   - 地図回答 + 4択選択肢
3. **結果画面**: 正解・不正解、学校情報、スコア
4. **最終結果**: 5問完了後の総合スコア・レベル判定

### 難易度設定
- **Easy**: 有名な地名・特徴的な自然環境が歌詞に含まれる
- **Medium**: 一般的な地理的特徴
- **Hard**: 抽象的表現や歴史的背景が中心

---

## 📚 参考資料・データソース

### 学術資料
- 渡辺裕『校歌斉唱！―日本人が育んだ学校文化の謎―』新潮社
- 須田珠生『校歌の誕生』人文書院
- [信時潔研究ガイド - 校歌データベース](https://nobutoki.com/koka_db)（893校データ）
- [文部科学省 学校基本調査](https://www.mext.go.jp/b_menu/toukei/chousa01/kihon/1267995.htm)

### データソース実装済み
- **1次ソース**: 信時潔データベース、国立国会図書館デジタルコレクション
- **2次ソース**: 都道府県教育委員会サイト
- **3次ソース**: 学校公式サイト、同窓会サイト

---

## 🔄 プロジェクト管理

### Issue管理（最新状況）
- **#10**: パイロット実行開始（P0・実行中）🔄
- **#8**: 大量データ収集プロジェクト（P0・実行フェーズ）
- **#9**: データ収集基盤構築（P0・完了）✅
- **#7**: 地図中心UI改善（P0・完了）✅
- **#1-5**: 基礎調査・技術選定（完了）✅

### 進捗管理
- GitHub Projects使用
- 週次レビュー実施
- マイルストーン設定
- リアルタイム進捗監視（progress_dashboard.py）

---

## 📱 アプリケーション実行方法

### MVPゲームの起動（20校データ対応）
```bash
# MVPアプリの起動
cd mvp
npm install
npm run dev
```

ブラウザで `http://localhost:5173` にアクセス

### データ収集ツールの使用（Phase 3対応）
```bash
# セットアップ（初回のみ）
cd tools
./setup.sh

# Google API設定
# docs/google-api-setup.md の手順に従って設定
cp config.json.sample config.json
# config.json を編集してGoogle APIキー等を設定

# 🧪 パイロット実行テスト（DRY RUN）
python3 pilot_execution.py --dry-run

# 📊 進捗監視ダッシュボード
python3 progress_dashboard.py

# 🚀 パイロット実行（関東100校）
python3 pilot_execution.py

# 個別収集テスト
python3 data_collector.py --prefecture 東京都 --max-schools 3 --dry-run
```

---

## ⚖️ 課題・リスク

### 著作権・法的課題
- **校歌の著作権**: 作詞者・作曲者の権利確認が必要
- **パブリックドメイン**: 古い校歌（1953年以前の没作者）の活用
- **使用許可**: 現代の校歌使用には権利者許可が必要

### データ収集の課題
- **データ入手困難**: 統一されたデータベースが存在しない
- **品質確保**: 歌詞の正確性確保
- **網羅性**: 全国9,882校の完全カバーは困難

### 技術的課題
- **API制限**: Google APIクォータ管理
- **サイト構造変化**: 抽出ルールの継続改善
- **スケーラビリティ**: ユーザー増加への対応

---

## 💡 差別化ポイント

1. **教育的価値**: 単なるクイズではなく文化学習ツール
2. **地域密着**: 各地方の特色を活かしたコンテンツ
3. **データの質**: 学術的価値のある校歌データベース構築
4. **ユーザー体験**: 直感的で楽しいUI/UX
5. **技術革新**: 自動データ収集・品質管理システム

---

## 🎨 UI/UXコンセプト

### デザイン方針
- **親しみやすさ**: 老若男女が楽しめるインターフェース
- **視認性**: 地図と歌詞の同時表示での見やすさ
- **応答性**: 快適な操作感
- **学習促進**: 正解後の詳細情報表示

### ターゲットユーザー
- **主要**: 20-50代の日本在住者
- **副次**: 日本文化に興味のある海外ユーザー
- **教育**: 学校での地理・社会科教材として

---

## 📊 今後の展開

### パイロット実行（今週）
- **関東100校収集**: 2時間以内での完了目標
- **品質評価**: A+B級80%以上達成確認
- **ツール検証**: 自動収集システムの実用性確認
- **改善点特定**: 本格実行前の課題洗い出し

### 本格実行（来週以降）
- **全国1000校**: 8週間での完了目標
- **地域別展開**: 関東→関西→九州→その他の順
- **品質維持**: A+B級データ80%以上の継続
- **進捗監視**: 週次レビュー・リアルタイム管理

---

**最終更新**: 2025年8月2日  
**ステータス**: Phase 3開始・パイロット実行準備完了  
**次のアクション**: Google API設定→DRY RUN→パイロット実行開始  
**現在のマイルストーン**: パイロット実行（関東100校収集テスト）

**🚀 Phase 3開始 - パイロット実行準備完了・API設定→実行開始！**
