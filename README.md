# 校歌場所当てゲーム (Koka Location Quiz)

## 📝 プロジェクト概要

テレビ番組で見かけた「校歌の歌詞から学校の場所を推測する」ゲームをWebアプリ・スマホアプリ化するプロジェクトです。

### ゲームの仕組み
- 中学校の校歌から学校名を伏せた歌詞を表示
- 地図を見ながら（検索機能は使わず）どの学校かを予想
- 5回勝負でスコアを競う

## 🚀 **現在の状況（2025年8月9日更新）**

### 🎯 **Phase 3実行中: 関西120校収集 - Week 2進行中**

#### **2025年8月9日の現状:**
- ✅ **パイロット実行完了**: 関東108校収集成功（1時間52分、品質A+B級93.5%）
- ✅ **MVPアプリ**: 20校対応完了、関東108校追加準備中
- ✅ **データ収集システム**: 本格稼働中
- 🔄 **Week 2実行中**: 関西120校収集開始（8月9日〜15日）
- 📊 **累計進捗**: 関東108校 + 関西3校（テスト） = 111校 / 1000校（11.1%）

#### **進行中の作業:**
- 🏃‍♂️ **関西120校収集**: 大阪・京都・兵庫・奈良・滋賀・和歌山
- 📈 **品質目標**: A+B級90%以上
- ⏰ **完了目標**: 8月15日（Week 2終了）
- 🎯 **Week 2終了時**: 累計228校達成予定

---

### ✅ **Phase 2完了: MVPデータ拡張・データ収集基盤構築完了**

#### **MVP実装完了（20校対応）:**
- ✅ **データ量4倍増**: 5校 → **20校**（全国各地から厳選）
- ✅ **地域バランス**: 北海道から沖縄まで全地方カバー
- ✅ **難易度分散**: Easy 10校・Medium 9校・Hard 1校
- ✅ **ゲーム体験向上**: リプレイ性・満足度大幅向上
- ✅ **評価システム強化**: 校歌マスター等のレベル判定

#### **データ収集システム（本格稼働中）:**
- ✅ **自動データ収集ツール**: `tools/data_collector.py`
- ✅ **品質管理システム**: `tools/quality_manager.py`（A/B/C/D級評価）
- ✅ **進捗監視ダッシュボード**: `tools/progress_dashboard.py`（リアルタイム可視化）
- ✅ **関西収集システム**: `tools/kansai_collection.py`（Week 2専用）
- ✅ **Googleスプレッドシート連携**: `tools/sheets_manager.py`

**技術スタック（確定版）：**
```javascript
{
  "frontend": "React + Vite + TypeScript",
  "styling": "Tailwind CSS",
  "icons": "Lucide React", 
  "map": "React Leaflet + OpenStreetMap",
  "data_collection": "Python + BeautifulSoup + Google APIs",
  "visualization": "matplotlib + seaborn + plotly",
  "deployment": "Vercel Ready"
}
```

---

### 🎯 **Phase 3実行計画: 全国1000件データベース構築**

#### **実行段階（Week 2進行中）**

**📊 パイロット実行成果（完了）:**
- ✅ **関東108校収集完了** - 目標100校を8%上回る
- ✅ **品質A+B級93.5%** - 目標80%を大幅クリア
- ✅ **実行時間1時間52分** - 目標2時間以内で完了
- ✅ **全成功指標達成** - システムの実用性完全実証

**🔧 Week 2関西収集（進行中）:**
- **対象地域**: 関西6府県（大阪・京都・兵庫・奈良・滋賀・和歌山）
- **目標件数**: 120校
- **進行状況**: 8月9日開始、テストデータ3校投入完了
- **品質目標**: A+B級90%以上
- **完了目標**: 8月15日

**📈 Week 2実行計画:**
- **大阪府**: 35校（大阪市・堺市・東大阪市中心）
- **兵庫県**: 30校（神戸市・西宮市・姫路市中心）
- **京都府**: 25校（京都市・宇治市中心）
- **奈良県**: 15校（奈良市・橿原市中心）
- **滋賀県**: 10校（大津市・草津市中心）
- **和歌山県**: 5校（和歌山市中心）

**📅 Phase 3全体スケジュール:**
- **Week 1 ✅**: 関東108校完了
- **Week 2 🔄**: 関西120校収集中（累計228校予定）
- **Week 3**: 中部100校（愛知・静岡・三重）
- **Week 4**: 九州北部120校（福岡・佐賀・長崎・熊本）
- **Week 5**: 九州南部・沖縄100校（大分・宮崎・鹿児島・沖縄）
- **Week 6**: 中部・北陸120校（新潟・富山・石川・福井・長野）
- **Week 7**: 北海道・東北150校
- **Week 8**: 中国・四国・調整200校（累計1,018校目標）

---

### 🎮 **現在のゲーム体験（20校対応）**

**ゲームフロー:**
```
校歌全文表示 → 地図で推測（メイン） → 困ったらヒント → 4択（最終手段） → 結果表示
```

**特徴:**
- 🗺️ **地図機能がメイン**: クリックして回答、50km以内で正解
- 📖 **校歌全文表示**: 学校名も含む完全版が読める
- 💡 **段階的ヒント機能**: 都道府県→地域→4択（使用で減点）
- 📊 **スコア調整**: 地図回答ボーナス+20点、ヒント使用で-20点/個
- 🎯 **20校データ**: 全国各地の多様な学校で充実したゲーム体験

**収録学校（20校）:**
- **北海道・東北**: 札幌雪原・仙台杜・津軽 (3校)
- **関東**: 戸山・横浜港・鎌倉・筑波研究 (4校)  
- **中部**: 千曲川・富士山・加賀温泉 (3校)
- **関西**: 京都古都・大阪商人・奈良古寺 (3校)
- **中国・四国**: 瀬戸内・広島平和・高知土佐 (3校)
- **九州・沖縄**: 博多祭・熊本城・桜島・首里城 (4校)

---

## 🎯 プロジェクト目標

1. **教育的価値**: 日本の地理・文化への理解促進
2. **エンターテイメント性**: 楽しく学べるクイズゲーム
3. **技術的挑戦**: モダンなWeb/モバイルアプリ開発
4. **データ活用**: 校歌という文化資産のデジタル化
5. **スケーラビリティ**: 1000件データベースの構築・運用

## 🚀 開発フェーズ（最新版）

### ~~Phase 1: MVP構築~~ ✅ **完了**
- [x] React + Vite + TypeScript基盤
- [x] 地図中心のゲームUI
- [x] 校歌全文表示・ヒント機能
- [x] 20校サンプルデータ

### ~~Phase 2: データ収集基盤~~ ✅ **完了**
- [x] 自動データ収集ツール開発
- [x] 品質管理システム構築
- [x] Googleスプレッドシート連携
- [x] 進捗監視ダッシュボード構築
- [x] パイロット実行システム完成・実行成功

### Phase 3: 大量データ収集 🔄 **Week 2実行中**
- [x] **Week 1**: パイロット実行（関東108校）✅**完了**
- [x] **Week 2**: 関西120校収集🔄**進行中**（8月9日〜15日）
- [ ] **Week 3**: 中部100校収集（愛知・静岡・三重）
- [ ] **Week 4**: 九州北部120校（福岡・佐賀・長崎・熊本）
- [ ] **Week 5**: 九州南部・沖縄100校（大分・宮崎・鹿児島・沖縄）
- [ ] **Week 6**: 中部・北陸120校（新潟・富山・石川・福井・長野）
- [ ] **Week 7**: 北海道・東北150校
- [ ] **Week 8**: 中国・四国・調整200校（最終調整）

### Phase 4: 機能拡張（8週間）
- [ ] ユーザー認証・アカウント機能
- [ ] ランキング・ソーシャル機能
- [ ] 実績システム・バッジ機能
- [ ] SNS連携・シェア機能

### Phase 5: テスト・リリース（4週間）
- [ ] 総合テスト・品質保証
- [ ] パフォーマンス最適化
- [ ] 本格リリース・マーケティング
- [ ] 運用保守体制構築

---

## 🏗️ システムアーキテクチャ

### 確定済み技術スタック

#### フロントエンド（実装済み）
- **Web**: React + Vite + TypeScript
- **UI/UX**: Tailwind CSS
- **アイコン**: Lucide React
- **地図**: React Leaflet + OpenStreetMap

#### データ収集・管理（本格稼働中）
- **収集エンジン**: Python + BeautifulSoup + Requests
- **API連携**: Google Custom Search API + Geocoding API
- **品質管理**: 自動品質判定・重複検出
- **データ管理**: Googleスプレッドシート + CSV/JSON
- **可視化**: matplotlib + seaborn + plotly

#### 将来検討
- **バックエンド**: Node.js + Express または Python + FastAPI
- **データベース**: PostgreSQL + Redis（キャッシュ）
- **認証**: Firebase Auth または Auth0

### データ構造設計（実装済み）

```typescript
interface SchoolData {
  id: number;
  schoolName: string;
  prefecture: string;
  city: string;
  address: string;
  coordinates: {
    lat: number;
    lng: number;
  };
  songTitle: string;
  lyrics: string;           // 全文歌詞
  maskedLyrics: string;     // マスク済み
  difficulty: 'easy' | 'medium' | 'hard';
  notes: string;
  hints: {
    prefecture: string;     // 都道府県ヒント
    region: string;         // 地域ヒント  
    landmark: string;       // 地理的特徴ヒント
  };
  composer?: string;
  lyricist?: string;
  establishedYear?: number;
  dataSource: string;
  qualityLevel?: string;    // A/B/C/D級品質評価
  collectionBatch?: string; // 収集バッチ識別
}
```

---

## 🎮 ゲーム仕様

### 現在のMVP仕様（20校対応・実装済み）
1. **ゲーム開始画面**: ルール説明、データ統計表示、スタートボタン
2. **クイズ画面**: 
   - 校歌全文表示（学校名含む）
   - 地図メインUI（左：歌詞、右：地図）
   - 段階的ヒント機能（3段階）
   - 地図回答 + 4択選択肢
3. **結果画面**: 正解・不正解、学校情報、スコア
4. **最終結果**: 5問完了後の総合スコア・レベル判定

### 難易度設定
- **Easy**: 有名な地名・特徴的な自然環境が歌詞に含まれる
- **Medium**: 一般的な地理的特徴
- **Hard**: 抽象的表現や歴史的背景が中心

---

## 📚 参考資料・データソース

### 学術資料
- 渡辺裕『校歌斉唱！―日本人が育んだ学校文化の謎―』新潮社
- 須田珠生『校歌の誕生』人文書院
- [信時潔研究ガイド - 校歌データベース](https://nobutoki.com/koka_db)（893校データ）
- [文部科学省 学校基本調査](https://www.mext.go.jp/b_menu/toukei/chousa01/kihon/1267995.htm)

### データソース実装済み
- **1次ソース**: 信時潔データベース、国立国会図書館デジタルコレクション
- **2次ソース**: 都道府県教育委員会サイト
- **3次ソース**: 学校公式サイト、同窓会サイト

---

## 🔄 プロジェクト管理

### Issue管理（最新状況）
- **#11**: Phase 3本格実行開始（P0・Week 2実行中）🔄
- **#10**: パイロット実行開始（P0・完了）✅
- **#9**: データ収集基盤構築（P0・完了）✅
- **#8**: 大量データ収集プロジェクト（P0・実行中）🔄
- **#7**: 地図中心UI改善（P0・完了）✅
- **#1-5**: 基礎調査・技術選定（完了）✅

### 進捗管理
- GitHub Projects使用
- 週次レビュー実施
- マイルストーン設定
- リアルタイム進捗監視（progress_dashboard.py）

---

## 📱 アプリケーション実行方法

### MVPゲームの起動（20校データ対応）
```bash
# MVPアプリの起動
cd mvp
npm install
npm run dev
```

ブラウザで `http://localhost:5173` にアクセス

### データ収集ツールの使用（Week 2実行中）
```bash
# セットアップ（初回のみ）
cd tools
./setup.sh

# Google API設定
# docs/google-api-setup.md の手順に従って設定
cp config.json.production config.json
# config.json を編集してGoogle APIキー等を設定

# 🧪 関西収集 DRY RUN
python3 kansai_collection.py --dry-run

# 📊 進捗監視ダッシュボード
python3 progress_dashboard.py --region 関西

# 🚀 関西120校収集実行（Week 2）
python3 kansai_collection.py

# 品質管理
python3 quality_manager.py --target-ab-rate 90
```

**📋 データ保存先:**
- **Googleスプレッドシート**: [校歌データ収集](https://docs.google.com/spreadsheets/d/1ukF5ZhpwJkN21wHLTaTS13BYTk5puKPisdQ1fGR5BwE/edit?usp=sharing)
- **ローカルファイル**: `tools/` フォルダ内にJSON・CSVで自動保存

---

## ⚖️ 課題・リスク

### 著作権・法的課題
- **校歌の著作権**: 作詞者・作曲者の権利確認が必要
- **パブリックドメイン**: 古い校歌（1953年以前の没作者）の活用
- **使用許可**: 現代の校歌使用には権利者許可が必要

### データ収集の課題
- **データ入手困難**: 統一されたデータベースが存在しない
- **品質確保**: 歌詞の正確性確保
- **網羅性**: 全国9,882校の完全カバーは困難

### 技術的課題
- **API制限**: Google APIクォータ管理
- **サイト構造変化**: 抽出ルールの継続改善
- **スケーラビリティ**: ユーザー増加への対応

---

## 💡 差別化ポイント

1. **教育的価値**: 単なるクイズではなく文化学習ツール
2. **地域密着**: 各地方の特色を活かしたコンテンツ
3. **データの質**: 学術的価値のある校歌データベース構築
4. **ユーザー体験**: 直感的で楽しいUI/UX
5. **技術革新**: 自動データ収集・品質管理システム

---

## 🎨 UI/UXコンセプト

### デザイン方針
- **親しみやすさ**: 老若男女が楽しめるインターフェース
- **視認性**: 地図と歌詞の同時表示での見やすさ
- **応答性**: 快適な操作感
- **学習促進**: 正解後の詳細情報表示

### ターゲットユーザー
- **主要**: 20-50代の日本在住者
- **副次**: 日本文化に興味のある海外ユーザー
- **教育**: 学校での地理・社会科教材として

---

## 📊 今後の展開

### 関西収集完了後（Week 2終了後 - 8月16日以降）
- **中部100校**: 愛知・静岡・三重（Week 3）
- **九州展開**: 福岡・佐賀・長崎・熊本（Week 4）
- **全国拡大**: 北海道・東北・中国・四国（Week 5-8）
- **MVPアプリ統合**: 累計データの段階的統合

### 本格実行完了後（Phase 3完了）
- **全国1000校**: 8週間での完了目標
- **地域別展開**: 関東→関西→九州→その他の順
- **品質維持**: A+B級データ80%以上の継続
- **プロダクト価値**: 世界最大級の校歌データベース

---

**最終更新**: 2025年8月9日  
**ステータス**: Phase 3 Week 2実行中・関西120校収集進行中  
**次のアクション**: 関西120校収集完了→Week 3中部収集準備  
**現在のマイルストーン**: Week 2完了（8月15日）・累計228校達成目標

**🚀 Week 2関西収集実行中 - 全国1000校データベース構築推進中！**
